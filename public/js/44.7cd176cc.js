(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[44],{"6a66":function(t,e,a){"use strict";a.r(e);a("4de4"),a("ac1f"),a("841c"),a("a15b"),a("1276");var r=function(){var t=this,e=t._self._c;return e("q-page",{staticClass:"q-pb-xl"},[e("q-header",{class:t.getHeaderColorBrand},[e("q-toolbar",[e("q-btn",{attrs:{to:{name:"Settings"},flat:"",round:"",dense:"",icon:"eva-arrow-back"}}),e("q-toolbar-title",[t._v("\n        List Pesanan\n      ")])],1),e("div",{staticClass:"box-shadow bg-white text-dark"},[e("q-tabs",{attrs:{"active-color":"primary","outside-arrows":""},model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}},t._l(t.options,(function(t){return e("q-tab",{key:t.value,attrs:{name:t.value,label:t.label,"no-caps":""}})})),1)],1)],1),e("div",{staticClass:"q-py-md auto-padding-side"},[e("div",{staticClass:"q-gutter-x-sm q-mt-sm"},[e("q-input",{staticClass:"bg-grey-3 q-px-sm",attrs:{placeholder:"No invoice, nama, email atau ponsel customer",dense:"",borderless:"",clearable:""},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleSearchOrder.apply(null,arguments)},clear:t.clearSearch},scopedSlots:t._u([{key:"append",fn:function(){return[e("q-icon",{staticClass:"cursor-pointer",attrs:{name:"eva-search"},on:{click:t.handleSearchOrder}})]},proxy:!0}]),model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1)]),t.orders.count>0?[e("div",[e("q-separator"),e("q-list",{attrs:{separator:""}},[e("q-item",{staticClass:"bg-grey-2"},[e("q-item-section",{staticClass:"gt-xs",attrs:{side:""}},[t._v("\n            #\n          ")]),e("q-item-section",[e("q-item-label",[t._v("Detail")])],1),e("q-item-section",{attrs:{side:""}},[e("q-item-label",[t._v("Actions")])],1)],1),t._l(t.orders.data,(function(a,r){return e("q-item",{key:r},[e("q-item-section",{staticClass:"gt-xs",attrs:{side:"",top:""}},[t._v("\n            "+t._s(r+1)+"\n          ")]),e("q-item-section",{attrs:{top:""}},[e("div",[e("table",{staticClass:"dense"},[e("tr",[e("td",[t._v("Customer")]),e("td",[t._v(t._s(a.customer_name))])]),e("tr",[e("td",[t._v("Invoice")]),e("td",[t._v(t._s(a.order_ref))])]),e("tr",[e("td",[t._v("Tanggal")]),e("td",[t._v(t._s(a.created))])]),e("tr",[e("td",[t._v("Total")]),e("td",[t._v(t._s(t.moneyIDR(a.grand_total)))])]),e("tr",[e("td",[t._v("Status")]),e("td",[e("q-badge",{attrs:{color:t.getOrderStatusColor(a.order_status)}},[t._v(t._s(a.status_label))])],1)]),e("tr",[e("td",[t._v("Pembayaran")]),e("td",[e("q-badge",{attrs:{color:t.getOrderStatusColor(a.transaction.status)}},[t._v(t._s(a.transaction.status_label)+"\n                    ")]),e("span",{staticClass:"text-xs q-pl-xs"},[t._v("("+t._s(a.transaction?a.transaction.payment_method.split("_").join(" "):"")+")")])],1)]),e("tr",[e("td",[t._v("Pengiriman")]),e("td",[t._v(t._s("COD"==a.shipping_courier_name?"Diantar Kurir Toko":a.shipping_courier_name)+"\n                  ")])]),a.shipping_courier_code?e("tr",[e("td",[t._v("No Resi")]),e("td",[t._v(t._s(a.shipping_courier_code))])]):t._e()])])]),e("q-item-section",{attrs:{side:"",top:""}},[e("div",{staticClass:"q-gutter-xs column order-btn-group"},[e("q-btn",{staticClass:"btn-order-item",attrs:{unelevated:"","no-caps":"",padding:"6px 12px",size:"12px",label:"Detail",color:"purple",to:{name:"AdminOrderShow",params:{order_ref:a.order_ref}}}}),e("q-btn",{staticClass:"btn-order-item",attrs:{unelevated:"","no-caps":"",padding:"6px 12px",size:"12px",label:t.messageButtonLabel(a.order_status),color:"amber-9"},on:{click:function(e){return t.handleFollowUp(a)}}}),t.canInputResi(a)?e("q-btn",{staticClass:"btn-order-item",attrs:{unelevated:"","no-caps":"",padding:"6px 12px",size:"12px",label:"Input Resi",color:"teal"},on:{click:function(e){return t.handleInputResi(a)}}}):t._e(),t.canShip(a)?e("q-btn",{staticClass:"btn-order-item",attrs:{unelevated:"","no-caps":"",padding:"6px 12px",size:"12px",label:"COD"==a.shipping_courier_name?"Antar COD":"Kirim",color:"blue"},on:{click:function(e){return t.handleKirim(a)}}}):t._e(),t.canComplete(a)?e("q-btn",{staticClass:"btn-order-item",attrs:{unelevated:"","no-caps":"",padding:"6px 12px",size:"12px",label:"Order Selesai",color:"green"},on:{click:function(e){return t.handleCompletionOrder(a)}}}):t._e(),t.canConfirm(a)?e("q-btn",{staticClass:"btn-order-item",attrs:{unelevated:"","no-caps":"",padding:"6px 12px",size:"12px",label:"Konfirmasi",color:"blue"},on:{click:function(e){return t.handleConfirmationOrder(a)}}}):t._e(),t.canCancelOrder(a)?e("q-btn",{staticClass:"btn-order-item",attrs:{unelevated:"","no-caps":"",padding:"6px 12px",size:"12px",label:"Batalkan",color:"red"},on:{click:function(e){return t.handleCancelOrder(a)}}}):t._e()],1)])],1)}))],2)],1),e("div",{staticClass:"flex justify-center q-py-xl"},[t.orders.count>t.orders.data.length?e("q-btn",{attrs:{outline:"",loading:t.orders.isLoadMore,label:"loadmore...",unelevated:"",color:"primary"},on:{click:t.loadMore}}):t._e()],1)]:t._e(),t.orders.ready&&t.orders.count<=0?e("div",{staticClass:"text-center q-pt-xl"},[t._v("Tidak ada data")]):t._e(),e("q-dialog",{attrs:{persistent:""},model:{value:t.followUpModal,callback:function(e){t.followUpModal=e},expression:"followUpModal"}},[e("follow-up",{attrs:{order:t.currentOrder},on:{close:function(e){t.followUpModal=!1}}})],1),e("q-dialog",{model:{value:t.inputResiModal,callback:function(e){t.inputResiModal=e},expression:"inputResiModal"}},[e("q-card",{staticStyle:{width:"100%","max-width":"420px"},attrs:{square:""}},[e("div",{staticClass:"q-px-md q-py-sm bg-dark text-white text-weight-bold"},[t._v("Input Resi "),t.orderSelected?e("span",[t._v("# "+t._s(t.orderSelected.order_ref))]):t._e()]),e("form",{on:{submit:function(e){return e.preventDefault(),t.submitResi.apply(null,arguments)}}},[e("q-card-section",[e("div",{staticClass:"text-grey-8"},[t._v("No Resi")]),e("q-input",{attrs:{outlined:"",rules:[function(t){return t&&t.length>0||"Wajib diisi"}]},model:{value:t.form.resi,callback:function(e){t.$set(t.form,"resi",e)},expression:"form.resi"}}),e("q-checkbox",{attrs:{label:"Update Status ( Dikirim )"},model:{value:t.form.update_to_ship,callback:function(e){t.$set(t.form,"update_to_ship",e)},expression:"form.update_to_ship"}}),e("div",{staticClass:"flex justify-end q-mt-sm q-gutter-x-sm"},[e("q-btn",{attrs:{outline:"",label:"Batal",color:"primary"},on:{click:function(e){return e.preventDefault(),t.closeModal.apply(null,arguments)}}}),e("q-btn",{attrs:{unelevated:"",type:"submit",label:"Simpan",color:"primary"}})],1)],1)],1)])],1),e("q-inner-loading",{attrs:{showing:t.loading}})],2)},n=[],i=a("ded3"),s=a.n(i),o=(a("d3b7"),a("e6cf"),a("a79d"),a("2f62")),l=function(){var t=this,e=t._self._c;return e("q-card",{staticStyle:{width:"100%","max-width":"400px"}},[e("form",{on:{submit:function(e){return e.preventDefault(),t.submitMessage.apply(null,arguments)}}},[e("div",{staticClass:"q-px-md q-pt-md"},[e("div",{staticClass:"text-h6"},[t._v(t._s(t.messageButtonLabel))]),e("div",{staticClass:"text-xs text-grey-7"},[t._v("Anda bisa mengedit dengan format pesan anda sendiri.")])]),e("q-card-section",{staticClass:"scroll",staticStyle:{"max-height":"80vh"}},[e("q-input",{staticClass:"textarea-input",attrs:{outlined:"",type:"textarea",rows:"18"},model:{value:t.message,callback:function(e){t.message=e},expression:"message"}}),e("div",{staticClass:"q-mt-md flex justify-end q-gutter-x-sm"},[e("q-btn",{attrs:{outline:"",color:"primary",type:"button",label:"Batal","no-caps":"",unelevated:""},on:{click:function(e){return e.preventDefault(),t.$emit("close")}}}),e("q-btn",{attrs:{unelevated:"",type:"submit",label:"Kirim Whatsapp",color:"primary","no-caps":""}})],1)],1)],1)])},d=[],c=(a("99af"),a("5319"),a("2ca0"),a("159b"),a("b0c0"),{props:["order"],data:function(){return{message:""}},computed:{shop:function(){return this.$store.state.shop},banks:function(){return this.$store.state.bank.banks},messageButtonLabel:function(){return"PENDING"==this.order.order_status?"Follow Up Message":"Send Message"}},methods:{submitMessage:function(){var t="https://api.whatsapp.com/send?phone=".concat(this.formatPhoneNumber(this.order.customer_whatsapp),"&text=").concat(encodeURI(this.message));window.open(t,"_blank")},money:function(t){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(t)},formatPhoneNumber:function(t){var e=t.replace(/\D/g,"");return e.startsWith("0")&&(e="62"+e.substr(1)),e},getRoutePath:function(){var t=this.$router.resolve({name:"UserInvoice",params:{order_ref:this.order.order_ref}});return location.origin+t.href},setPaymentMessage:function(){var t="Silahkan lakukan pembayaran ke nomor rekening berikut:\n\n";return this.banks.data.length?(this.banks.data.forEach((function(e){t+="*".concat(e.bank_name," - ").concat(e.bank_office,"*\nNorek: ").concat(e.account_number,"\nA.n ").concat(e.account_name,"\n\n")})),t):""},setTextMessage:function(){if(this.order)if("PENDING"==this.order.order_status){var t="Halo kak ".concat(this.order.customer_name,"\n");t+="kami dari *".concat(this.shop.name?this.shop.name:"...","*\n"),t+="berikut adalah pesanan kakak pada toko kami:\n\n",t+="Invoice : *".concat(this.order.order_ref,"*\n"),t+="Di pesan pada : ".concat(this.order.created,"\n"),t+="Subtotal : ".concat(this.moneyIDR(this.order.order_subtotal),"\n"),t+="Ongkos Kirim : ".concat(this.moneyIDR(this.order.shipping_cost),"\n"),this.order.order_unique_code&&(t+="Kode Unik : ".concat(this.order.order_unique_code,"\n")),this.order.service_fee&&(t+="Service Fee : ".concat(this.order.service_fee,"\n")),this.order.payment_fee&&(t+="Payment Fee: ".concat(this.moneyIDR(this.order.payment_fee),"\n")),t+="\n*Total : ".concat(this.moneyIDR(this.order.grand_total),"*\n\n"),t+="Untuk detail tagihan dapat dilihat di ".concat(this.getRoutePath(),"\n\n"),t+="Terima Kasih",this.message=t}else{var e="Halo kak ".concat(this.order.customer_name,"\nkami dari ").concat(this.shop.name?this.shop.name:"...","\n\n......\n\nTerima Kasih\n           ");this.message=e}}},mounted:function(){this.setTextMessage()}}),u=c,p=a("2877"),m=a("f09f"),h=a("a370"),f=a("27f9"),b=a("9c40"),_=a("eebe"),g=a.n(_),v=Object(p["a"])(u,l,d,!1,null,null,null),k=v.exports;g()(v,"components",{QCard:m["a"],QCardSection:h["a"],QInput:f["a"],QBtn:b["a"]});var y={name:"OrderIndex",components:{FollowUp:k},data:function(){return{isFilter:!0,options:[{value:"ALL",label:"Semua"},{value:"PENDING",label:"Pending"},{value:"TOSHIP",label:"Perlu Dikirim"},{value:"SHIPPING",label:"Dikirim"},{value:"COMPLETE",label:"Selesai"},{value:"CANCELED",label:"Batal"}],inputResiModal:!1,orderSelected:"",followUpModal:!1,currentOrder:null,search:"",filter:"ALL",form:{order_id:"",resi:"",status:"",update_to_ship:!1}}},watch:{filter:function(t,e){t!=e&&(this.form.status=t,localStorage.setItem("order_filter",t),this.filterOrder(t))}},computed:s()(s()({},Object(o["d"])({orders:function(t){return t.order.orders},loading:function(t){return t.loading}})),{},{isMobile:function(){return window.innerWidth<=800}}),created:function(){this.orders.data.length<=this.orders.limit&&(this.$route.query.filter?(this.setFilter(this.$route.query.filter),this.filterOrder(this.filter)):localStorage.getItem("order_filter")?(this.setFilter(localStorage.getItem("order_filter")),this.filterOrder(this.filter)):this.getOrders())},methods:s()(s()({},Object(o["b"])("order",["getOrders","getPaginateOrder","getPaginateFilterOrder","destroyOrder","acceptPayment","inputResi","updateStatusOrder","searchOrder","filterOrder","cancelOrder"])),{},{loadMore:function(){this.getPaginateOrder({filter:this.filter,skip:this.orders.data.length})},clearSearch:function(){this.setFilter("ALL"),this.filterOrder(this.filter)},setFilter:function(t){this.filter=t,localStorage.setItem("order_filter",t)},handleSelectMode:function(t){this.isFilter=!this.isFilter,this.search="",this.setFilter("ALL")},changeTab:function(t){this.$router.push({name:"OrderIndex",query:{filter:t}}),this.search="",this.filterOrder(t)},handleKirim:function(t){var e=this;this.$q.dialog({title:"Konfirmasi",message:'Akan mengirim pesanan sekarang?, ini akan merubah status pesanan menjadi "sedang dikirim"',cancel:!0}).onOk((function(){e.form.status="SHIPPING",e.form.order_id=t.id,e.handleUpdateStatusOrder()}))},handleUpdateStatusOrder:function(){var t=this;this.$store.commit("SET_LOADING",!0),this.updateStatusOrder(this.form).then((function(){t.setFilter(t.form.status),t.filterOrder(t.filter)})).finally((function(){return t.$store.commit("SET_LOADING",!1)}))},handleCancelOrder:function(t){var e=this;this.$q.dialog({title:"Konfirmasi Pembatalan order",message:"Akan membatalkan order ini?, perubahan ini tidak dapat dikembalikan",cancel:!0}).onOk((function(){e.form.status="CANCELED",e.form.order_id=t.id,e.cancelOrder(t.id).then((function(){e.setFilter(e.form.status),e.filterOrder(e.filter)}))}))},canShip:function(t){return"COD"==t.transaction.payment_type&&"PENDING"==t.order_status||("COD"==t.shipping_courier_name&&"TOSHIP"==t.order_status||!("TOSHIP"!=t.order_status||!t.shipping_courier_code))},canComplete:function(t){return"SHIPPING"==t.order_status},canCancelOrder:function(t){return"PENDING"==t.order_status},handleCompletionOrder:function(t){var e=this;this.$q.dialog({title:"Konfirmasi",message:'Ini akan merubah status pesanan menjadi "selesai" dan status pembayaran jadi "Dibayar" apabila menggunakan pembayaran COD',cancel:!0}).onOk((function(){e.form.status="COMPLETE",e.form.order_id=t.id,e.handleUpdateStatusOrder()}))},handleSearchOrder:function(){this.search&&(this.$store.commit("SET_LOADING",!0),this.searchOrder(this.search))},resetOrder:function(){this.orderFiltered=[],this.isFilter=!1,this.setFilter("ALL")},canConfirm:function(t){return"PENDING"==t.order_status&&"COD"!=t.transaction.payment_type&&"UNPAID"==t.transaction.status},canInputResi:function(t){return"COD"!=t.shipping_courier_name&&("TOSHIP"==t.order_status&&!t.shipping_courier_code)},messageButtonLabel:function(t){return"PENDING"==t?"Follow Up":"Kirim Pesan"},handleDeleteOrder:function(t){var e=this;this.$q.dialog({title:"Yakin akan menghapus data?",message:"data yang dihapus tidak dapat dikembalikan.",ok:{label:"Hapus",flat:!0,"no-caps":!0,color:"red-7"},cancel:{label:"Batal",flat:!0,"no-caps":!0}}).onOk((function(){e.destroyOrder(t).then((function(t){200==t.status&&e.filterOrder(e.filter)}))})).onCancel((function(){})).onDismiss((function(){}))},handleConfirmationOrder:function(t){var e=this,a="Pastikan pembayaran telah anda terima dengan baik",r="Konfirmasi";"PAYMENT_GATEWAY"==t.transaction.payment_type&&(a="<b>WARNING!</b>, Metode pembayaran menggunakan payment gateway, Seharusnya status pesanan dan status pembayaran akan <b>otomatis</b> berubah jika sudah terjadi pembayaran di pihak payment gateway. Sangat tidak disarankan untuk merubah status secara manual",r="Konfirmasi Manual"),this.$q.dialog({title:"Konfirmasi pembayaran",message:a,cancel:!0,ok:{label:r,flat:!0},html:!0}).onOk((function(){e.acceptPayment(t.id).then((function(){e.setFilter("TOSHIP"),e.filterOrder(e.filter)}))})).onCancel((function(){})).onDismiss((function(){}))},handleFollowUp:function(t){this.currentOrder=t,this.followUpModal=!0},handleInputResi:function(t){this.form.resi="",this.orderSelected=t,this.form.order_id=t.id,this.inputResiModal=!0},closeModal:function(){this.inputResiModal=!1,this.orderSelected="",this.form.order_id=""},submitResi:function(){var t=this;this.inputResi(this.form).then((function(e){if(200==e.status){var a=e.data.results.order_status;t.setFilter(a),t.filterOrder(t.filter)}})),this.closeModal()}}),meta:function(){return{title:"Order List"}}},O=y,x=a("9989"),q=a("e359"),C=a("65c6"),S=a("6ac5"),I=a("429b"),D=a("7460"),P=a("0016"),w=a("eb85"),N=a("1c1c"),M=a("66e5"),R=a("4074"),L=a("0170"),T=a("58a81"),F=a("24e8"),Q=a("8f8e"),A=a("74f7"),E=Object(p["a"])(O,r,n,!1,null,null,null);e["default"]=E.exports;g()(E,"components",{QPage:x["a"],QHeader:q["a"],QToolbar:C["a"],QBtn:b["a"],QToolbarTitle:S["a"],QTabs:I["a"],QTab:D["a"],QInput:f["a"],QIcon:P["a"],QSeparator:w["a"],QList:N["a"],QItem:M["a"],QItemSection:R["a"],QItemLabel:L["a"],QBadge:T["a"],QDialog:F["a"],QCard:m["a"],QCardSection:h["a"],QCheckbox:Q["a"],QInnerLoading:A["a"]})}}]);